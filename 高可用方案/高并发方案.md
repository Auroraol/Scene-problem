# 高并发解决方案



 前端优化 



 应用集群化 

单节点本身存在内存，CPU，网卡,IO等硬件资源的限制，因此更多的节点能够支持更大的并发。



 缓存 

增加缓存（如redis）可以加快诸如查询等操作，进而缩短对服务线程资源的占用，提高系统的吞吐量



 读写分离 

读写分离，可以既可以应用在缓存上，也可以应用在DB上。

 分库分表 

对于数据规模不是特别大的系统，可以通过分库分表来优化系统性能。



 分库 

分库通常都是按业务的纬度进行拆分。不同的业务系统使用独立的数据库。



 分表 

分表有水平拆分和垂直拆分



 水平拆分 

把单个大表的数据按照某个字段拆分成多张表。

拆分方案具体有：单库多表，多库单表和多库多表。



 垂直拆分 

把一个具有很多字段的表，把不常用的字段拆分出来，形成一张扩展表。以使单个数据块能够容纳更多的行，从而降低IO次数。



 数据分片 

对于数据规模比较大的系统，存储系统的架构需要采用数据分片这种更优的模式，所谓数据分片，是指每个存储节点存储系统的一部分数据，而非全量数据。这样的架构应对故障的能力相对更强一些，即使某些个节点故障，影响的也仅仅是部署用户或业务。但这种方式对于全局的数据搜索并不友好。解决这种的方案可以通过数据冗余（多纬度分区）或者通过构建搜索引擎来支持全局搜索。架构如下：



![数据分区.png](%E9%AB%98%E5%B9%B6%E5%8F%91%E6%96%B9%E6%A1%88.assets/1603856166789-fd5f3c69-1a2c-495d-b82f-0e226c07490c.webp)





 降级 

降级是指系统将某些业务或接口的功能降低，可以只提供部分功能，也可以完全停掉所有功能。

降级的核心思想就是丢车保帅，优先保证核心业务的正常运行。



 熔断 

与降级不同的是，降级的目的是应对系统自身的故障，而熔断的目的是应对依赖的外部系统故障的情况。比如说，A服务的X功能依赖于B服务的某个接口,当B服务响应很缓慢，A服务的X功能响应肯定会被拖慢，进一步导致A服务的线程都被卡在X功能处理上，此时A服务的其他功能都会被卡住或响应非常缓慢。这时就需要熔断机制了，即：A服务不再请求B服务的这个接口，只要A服务发现请求B服务的这接口，就立即返回错误，避免A服务整个被拖慢致死。



 限流 

降级是从系统功能优先级的角度考虑如何应对故障，而限流是从用户访问压力的角度来考虑如何应对故障。

限流指只允许系统能够承受的访问量进来，超出系统访问能力的请求将被丢弃。



 限流分类 



 基于请求的限流 

基于请求限流指从外部访问请求的角度考虑限流。常见的方式有：限制总量，限制时间量。



●请求总量： 限制某个指标的累计上限，比如秒杀活动，商品库存100，最多支持1万个用户请求进来。

●时间量： 比如每秒请求数为5000等.



 基于资源的限流 

基于资源的限流指从系统内部考虑的。即：找出系统中影响性能的关键资源，对其使用上限进行限制，如：文件句柄，连接数，线程数等。



 排队 

排队是限流的一种，限流是直接拒绝用户，而排队是指让用户等待一段时间。著名的排队网站12306就是如此，排队虽然不拒绝用户请求，但用户体验并不一定好过限流。



一般单个系统受资源限制，并不能缓存太多的用户请求。通常会使用外部队列系统，诸如使用Kafka,RocketMQ等这样的消息中间件来缓存用户请求。



MQ本身具有高吞吐量，高可用，实时性好的优点，可以在流量高峰期削峰。而且，使用MQ可以使应用间解耦，使得应用具有更好的可扩展性。



 安利 

限流，熔断，降级可以使用阿里开源的Sentinel组件，Hystrix等